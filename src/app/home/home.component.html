<div fxLayoutAlign="center center" fxLayout="column">

  <div fxLayout="column" class="header">
    <app-header></app-header>
    <div id="subheading" [@transitionAnimations]="transition">Connecting you to the services you need...</div>
  </div>

  <div fxLayout="column" fxLayoutGap="1em" class="content">

    <mat-tab-group mat-align-tabs="start" [@transitionAnimations]="transition">

      <mat-tab label="Near Me">

        <div class="mat-tab-contents" fxLayout="column" fxLayoutGap="1.5em" fxLayoutAlign="start start">

          <div fxLayout="column" fxLayoutGap="1em" fxLayoutAlign="center center" fxFill class="progress-spinner" *ngIf="servicesNearMeState.loading==true">
            <mat-spinner [diameter]="75"></mat-spinner>
            <div>Loading...</div>
          </div>

          <form [formGroup]="servicesForm" id="find-services-form" [@transitionAnimations]="transition" fxFill
                *ngIf="servicesNearMeState.display==false && servicesNearMeState.loading==false">
            <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="5%">

              <mat-form-field fxFlex="50%" fxFlex.sm="50%" fxFlex.xs="100%">
                <mat-label><i class="fas fa-concierge-bell fa-sm"></i> Which services are you looking for?</mat-label>
                <mat-select formControlName="services" multiple [required]="true">
                  <mat-option *ngFor="let service of serviceList" [value]="service.service">{{service.service}}</mat-option>
                </mat-select>
                <mat-hint>
                  Select at least one type of service.
                </mat-hint>
                <mat-error *ngIf="servicesForm.get('services').hasError('required')">
                  Please select at least one type of service.
                </mat-error>
              </mat-form-field>

              <mat-form-field fxFlex="45%" fxFlex.sm="45" fxFlex.xs="100%">
                <mat-label><i class="fas fa-map-marker-alt fa-sm"></i> Where are you?</mat-label>
                <input matInput type="text" formControlName="location" placeholder="ex. 'Detroit' or '645 Griswold St, Detroit, MI'" [required]="true">
                <mat-hint>
                  Type in your city or address located in Michigan.
                </mat-hint>
                <mat-error *ngIf="servicesForm.get('location').hasError('required')">
                  A city or address located in Michigan is required.
                </mat-error>
              </mat-form-field>
            </div>

            <button type="button" mat-stroked-button [disabled]="!servicesForm.valid" id="find-services-button" (click)="findServices()">
              <span><i class="fas fa-search"></i> FIND SERVICES NEAR ME</span>
            </button>
          </form>

          <div fxLayout="column" fxFill fxLayoutGap="1em" *ngIf="servicesNearMeState.display==true && servicesNearMeState.loading==false">

            <div fxLayout="row" fxLayoutAlign="start start">
              <h3>Services Near {{servicesNearMeState.myLocation}}</h3>
              <span class="spacer"></span>
              <div>
                <button mat-stroked-button type="button" (click)="back()">BACK</button>
              </div>
            </div>

            <mat-card class="org-filter-controls mat-elevation-z0">
              <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="3em" fxLayoutGap.xs="2em">
                <div fxLayout="column" fxFlex="50" fxLayoutGap="1em">
                  <div><mat-slide-toggle [(ngModel)]="searchFilterControls.includeReligiousOrgs">Include religious organizations</mat-slide-toggle></div>
                  <div><mat-slide-toggle [(ngModel)]="searchFilterControls.includeOrgsWithEligibilityReqs">No eligibility requirements</mat-slide-toggle></div>
                  <div><mat-slide-toggle [(ngModel)]="searchFilterControls.showOnlyOrgsWithTransport">Provides transportation</mat-slide-toggle></div>
                </div>
                <div fxLayout="column" fxFlex="45" fxLayoutGap="0">
                  <div>
                    Show organizations within <strong>{{searchFilterControls.distanceRadius}} mile<span *ngIf="searchFilterControls.distanceRadius>1">s</span></strong> from me.
                  </div>
                  <div>
                    <mat-slider fxFlex="100" [max]="100" [min]="1" [step]="1" [thumbLabel]="true" [tickInterval]="5" [(ngModel)]="searchFilterControls.distanceRadius"></mat-slider>
                  </div>
                </div>
              </div>
            </mat-card>

            <div *ngFor="let org of servicesNearMeState.orgList; last as isLast">

              <div fxLayout="row" fxLayoutGap="1em">
                <div fxLayout="column" fxFlex="50">
                  <a [routerLink]="['/service/view', org.name]">{{org.name}}</a>
                  <div>{{org.address.streetAddress1}}, {{org.address.city}}, {{org.address.state}}</div>
                  <div>Distance: {{org.distance}}</div>
                </div>
                <div fxLayout="column" fxFlex="50">
                  <strong>Services Provided</strong>
                  <span *ngFor="let service of org.services; last as isLast">
                    {{service}}<span *ngIf="!isLast">, </span>
                  </span>
                </div>
              </div>

              <mat-divider *ngIf="!isLast"></mat-divider>
            </div>

            <div *ngIf="servicesNearMeState.orgList==null || servicesNearMeState.orgList.length==0">
              No services found.
            </div>
          </div>

        </div>
      </mat-tab>

      <mat-tab label="By Categories">
        <div class="mat-tab-contents">
          <div fxLayout="row wrap" fxLayoutAlign="center">
            <a fxFlex="45%" fxFlex.xs="90%" href="#" [routerLink]="'services/view/'+service.service" routerLinkActive="active" class="service-tile" *ngFor="let service of serviceList">{{service.service}}</a>
          </div>
        </div>
      </mat-tab>

    </mat-tab-group>

  </div>

</div>
